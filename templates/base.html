<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}AI Lesson Planner{% endblock %}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Aleo:ital,wght@0,100..900;1,100..900&family=Spline+Sans:wght@300..700&display=swap"
    rel="stylesheet" />

  <!-- Tailwind config + CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind = tailwind || {};
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: "#f0f9ff",
              100: "#e0f2fe",
              200: "#bae6fd",
              300: "#7dd3fc",
              400: "#38bdf8",
              500: "#0ea5e9",
              600: "#2563eb",
              700: "#1d4ed8",
              800: "#1e40af",
              900: "#1e3a8a",
            },
            primary: "#E0F1FF",
            secondary: "#CDE1FA",
            surface: "#ffffff",
          },
          fontFamily: {
            sans: ["Spline Sans", "Inter", "sans-serif"],
          },
        },
      },
    };
  </script>


  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      lucide.createIcons();
    });
  </script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}" />

  {% block head_extra %}{% endblock %}

  <style>
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  </style>
  {% block styles %}{% endblock %}
</head>

<body class="min-h-screen bg-gradient-to-br from-primary via-sky-50 to-secondary text-slate-800 font-sans">
  <div class="flex min-h-screen">
    <!-- DESKTOP SIDEBAR -->
    <aside id="mainSidebar" class="hidden md:flex flex-col border-r border-blue-200/60 bg-white/80 backdrop-blur-xl h-screen sticky top-0
             transition-all duration-300 ease-in-out w-72 shadow-[10px_0_40px_rgba(15,23,42,0.08)]">

      <!-- Logo row -->
      <div
        class="h-16 flex items-center p-6 mt-4 flex-shrink-0 overflow-hidden whitespace-nowrap transition-all duration-300"
        id="sidebar-logo-row">
        <span class="sidebar-logo flex items-center justify-between w-full transition-all duration-300"
          id="sidebar-logo-link">
          <a href="{{ url_for('main.index') }}" class="sidebar-logo-text text-xl font-bold tracking-tight text-slate-900
                   bg-gradient-to-r from-brand-600 to-brand-800 bg-clip-text">
            AI Teacher Assistant
          </a>
          <button type="button" onclick="toggleDesktopSidebar()"
            class="sidebar-logo-icon hidden transition-all p-1 rounded-lg hover:bg-slate-100"
            aria-label="Expand sidebar">
            <i data-lucide="menu" class="w-5 h-5"></i>
          </button>
        </span>
        <button type="button" onclick="toggleDesktopSidebar()" id="sidebar-toggle-btn" class="ml-2 p-2 rounded-xl hover:bg-emerald-100 text-slate-500 border border-slate-200/80
                 transition-all active:scale-95 hidden md:inline-flex shadow-sm" title="Toggle sidebar">
          <i data-lucide="menu" class="w-5 h-5"></i>
        </button>
      </div>

      <!-- NAV -->
      <nav class="flex-1 p-4 space-y-2 overflow-y-auto overflow-x-hidden">
        <!-- Dashboard -->
        <a href="{{ url_for('main.index') }}" class="relative flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
                 {% if request.endpoint == 'main.index' %}
                   text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                   border border-emerald-300 shadow-md -translate-y-0.5
                 {% else %}
                   text-slate-600 hover:text-slate-900
                   hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                   border border-transparent hover:border-slate-200
                   hover:shadow-sm hover:-translate-y-0.5
                 {% endif %}
                 transition-all">

          <i data-lucide="home"
            class="relative w-5 h-5 flex-shrink-0
                   {% if request.endpoint == 'main.index' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}">
          </i>
          <span class="relative sidebar-text transition-opacity duration-200">Dashboard</span>
        </a>

        <!-- Batches – DESKTOP -->
        <a href="{{ url_for('batches.batches_page') }}" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
         {% if request.endpoint == 'batches.batches_page' %}
           text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                   border border-emerald-300 shadow-md -translate-y-0.5
                 {% else %}
                   text-slate-600 hover:text-slate-900
                   hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                   border border-transparent hover:border-slate-200
                   hover:shadow-sm hover:-translate-y-0.5
                 {% endif %}
         transition-all">
          <i data-lucide="users" class="w-5 h-5
           {% if request.endpoint == 'batches.batches_page' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}
           transition-colors">
          </i>
          <span class="sidebar-text transition-opacity duration-200">Batches</span>
        </a>



        <!-- Lesson Plans -->
        <a href="{{ url_for('lesson_plans.list_lesson_plans') }}" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
                 {% if request.endpoint == 'lesson_plans.list_lesson_plans' %}
                    text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                   border border-emerald-300 shadow-md -translate-y-0.5
                 {% else %}
                   text-slate-600 hover:text-slate-900
                   hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                   border border-transparent hover:border-slate-200
                   hover:shadow-sm hover:-translate-y-0.5
                 {% endif %}
                 transition-all">
          <i data-lucide="book-open" class="w-5 h-5
                   {% if request.endpoint == 'lesson_plans.list_lesson_plans' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}
                   transition-colors">
          </i>
          <span class="sidebar-text transition-opacity duration-200">Lesson Plans</span>
        </a>

        <!-- Assessments -->
        <a href="{{ url_for('assessments.list_assessments') }}" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
                 {% if request.endpoint == 'assessments.list_assessments' %}
                   text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                   border border-emerald-300 shadow-md -translate-y-0.5
                 {% else %}
                   text-slate-600 hover:text-slate-900
                   hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                   border border-transparent hover:border-slate-200
                   hover:shadow-sm hover:-translate-y-0.5
                 {% endif %}
                 transition-all">
          <i data-lucide="bar-chart-3" class="w-5 h-5
                   {% if request.endpoint == 'assessments.list_assessments' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}
                   transition-colors">
          </i>
          <span class="sidebar-text transition-opacity duration-200">Assessments</span>
        </a>

        <!-- Send Emails -->
        <a href="{{ url_for('email.email_page') }}" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
                 {% if request.endpoint == 'email.email_page' %}
                   text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                   border border-emerald-300 shadow-md -translate-y-0.5
                 {% else %}
                   text-slate-600 hover:text-slate-900
                   hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                   border border-transparent hover:border-slate-200
                   hover:shadow-sm hover:-translate-y-0.5
                 {% endif %}
                 transition-all">
          <i data-lucide="mail" class="w-5 h-5
                   {% if request.endpoint == 'email.email_page' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}
                   transition-colors">
          </i>
          <span class="sidebar-text transition-opacity duration-200">Send Emails</span>
        </a>
      </nav>

      <!-- PROFILE -->
      <div class="px-4 py-4 border-t border-slate-100 flex-shrink-0 transition-all duration-300"
        id="sidebar-profile-row">
        <div class="flex items-center gap-3 text-sm rounded-xl hover:bg-slate-50/80 p-2
                 transition-all duration-300 sidebar-profile-content">
          <div class="sidebar-profile-avatar">
            {% if session.get('picture') %}
            <img src="{{ session.get('picture') }}" alt="Avatar"
              class="w-9 h-9 rounded-full object-cover border-2 border-white shadow-sm" />
            {% else %}
            <span class="inline-flex items-center justify-center w-9 h-9 rounded-full
                     bg-gradient-to-tr from-brand-500 to-brand-700 text-white shadow-md shadow-brand-300/70">
              <i data-lucide="user" class="w-5 h-5"></i>
            </span>
            {% endif %}
          </div>
          <div class="sidebar-profile-text flex-1 min-w-0 transition-all duration-300">
            <div class="text-sm font-semibold text-slate-800 truncate">
              {{ session.get('name') or 'Profile' }}
            </div>
            <div class="text-xs text-slate-500 truncate">
              {{ session.get('email') or '' }}
            </div>
          </div>
          <a href="{{ url_for('auth.logout') }}"
            class="sidebar-logout-btn p-1.5 rounded-md hover:bg-red-50 text-slate-400 hover:text-red-600 transition-colors ml-2"
            onclick="return confirm('Are you sure you want to logout?');" title="Logout">
            <i data-lucide="log-out" class="w-4 h-4"></i>
          </a>
        </div>
      </div>
    </aside>

    <!-- MAIN AREA -->
    <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
      <!-- MOBILE HEADER -->
      <header class="md:hidden h-16 bg-white/80 backdrop-blur-xl border-b border-blue-200/60
               flex items-center justify-between px-4 sticky top-0 z-20 shadow-[0_4px_20px_rgba(148,163,184,0.35)]">
        <button id="openSidebar" class="inline-flex items-center justify-center p-2 rounded-lg text-slate-600 hover:bg-blue-50
                 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-brand-500" aria-label="Open menu">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <a href="{{ url_for('main.index') }}" class="text-lg font-bold text-slate-900 tracking-tight">
          AI Lesson Planner
        </a>
        <div class="w-10"></div>
      </header>

      <main class="flex-1 overflow-y-auto focus:outline-none p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
          {% with messages = get_flashed_messages(with_categories=True) %}
          {% if messages %}
          <div class="space-y-3 mb-6">
            {% for category, message in messages %}
            {% if category == 'success' or category == 'ok' %}
            {% set color_class = 'border-green-200/80 bg-gradient-to-r from-green-50 to-emerald-50 text-green-800' %}
            {% elif category == 'warning' %}
            {% set color_class = 'border-amber-200/80 bg-gradient-to-r from-amber-50 to-yellow-50 text-amber-800' %}
            {% elif category == 'error' or category == 'danger' %}
            {% set color_class = 'border-red-200/80 bg-gradient-to-r from-red-50 to-rose-50 text-red-800' %}
            {% else %}
            {% set color_class = 'border-blue-200/80 bg-gradient-to-r from-blue-50 to-sky-50 text-blue-800' %}
            {% endif %}
            <div
              class="border px-4 py-3 rounded-xl shadow-sm text-sm font-medium {{ color_class }} flex items-center gap-2">
              <span class="w-1.5 h-1.5 rounded-full bg-current/70"></span>
              <span>{{ message }}</span>
            </div>
            {% endfor %}
          </div>
          {% endif %}
          {% endwith %}

          {% block content %}{% endblock %}
        </div>
      </main>
    </div>
  </div>

  <!-- MOBILE DRAWER -->
  <div id="drawer" class="relative z-50 hidden md:hidden" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" data-close></div>
    <div class="fixed inset-0 flex">
      <div class="relative flex w-full max-w-xs flex-1 flex-col bg-white pb-4 pt-5 shadow-2xl rounded-r-2xl">

        <div class="absolute top-4 right-4 z-50">
          <button type="button" class="flex h-10 w-10 items-center justify-center rounded-full bg-white/90 hover:bg-emerald-50
                   focus:outline-none focus:ring-2 focus:ring-inset focus:ring-brand-500 shadow transition" data-close
            aria-label="Close sidebar">
            <svg class="h-6 w-6 text-slate-700" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
              aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <div class="flex flex-shrink-0 items-center px-4 mb-5">
          <span class="text-xl font-bold text-slate-900 tracking-tight">
            AI Teacher Assistant
          </span>
        </div>

        <div class="flex-1 overflow-y-auto">
          <nav class="space-y-2 px-4 pb-4">
            <!-- Dashboard -->
            <a href="{{ url_for('main.index') }}" class="relative flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
                     {% if request.endpoint == 'main.index' %}
                       text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                       border border-emerald-300 shadow-md -translate-y-0.5
                     {% else %}
                       text-slate-600 hover:text-slate-900
                       hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                       border border-transparent hover:border-slate-200
                       hover:shadow-sm hover:-translate-y-0.5
                     {% endif %}
                     transition-all">

              <i data-lucide="home"
                class="relative w-5 h-5 flex-shrink-0
                       {% if request.endpoint == 'main.index' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}">
              </i>
              <span class="relative">Dashboard</span>
            </a>

            <!-- Batches – MOBILE DRAWER -->
            <a href="{{ url_for('batches.batches_page') }}" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
         {% if request.endpoint == 'batches.batches_page' %}
           text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                       border border-emerald-300 shadow-md -translate-y-0.5
                     {% else %}
                       text-slate-600 hover:text-slate-900
                       hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                       border border-transparent hover:border-slate-200
                       hover:shadow-sm hover:-translate-y-0.5
                     {% endif %}
         transition-all">
              <i data-lucide="users" class="w-5 h-5
           {% if request.endpoint == 'batches.batches_page' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}
           transition-colors">
              </i>
              <span>Batches</span>
            </a>


            <!-- Lesson Plans -->
            <a href="{{ url_for('lesson_plans.list_lesson_plans') }}" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
                     {% if request.endpoint == 'lesson_plans.list_lesson_plans' %}
                       text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                       border border-emerald-300 shadow-md -translate-y-0.5
                     {% else %}
                       text-slate-600 hover:text-slate-900
                       hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                       border border-transparent hover:border-slate-200
                       hover:shadow-sm hover:-translate-y-0.5
                     {% endif %}
                     transition-all">
              <i data-lucide="book-open" class="w-5 h-5
                       {% if request.endpoint == 'lesson_plans.list_lesson_plans' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}
                       transition-colors">
              </i>
              <span>Lesson Plans</span>
            </a>

            <!-- Assessments -->
            <a href="{{ url_for('assessments.list_assessments') }}" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
                     {% if request.endpoint == 'assessments.list_assessments' %}
                       text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                       border border-emerald-300 shadow-md -translate-y-0.5
                     {% else %}
                       text-slate-600 hover:text-slate-900
                       hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                       border border-transparent hover:border-slate-200
                       hover:shadow-sm hover:-translate-y-0.5
                     {% endif %}
                     transition-all">
              <i data-lucide="bar-chart-3" class="w-5 h-5
                       {% if request.endpoint == 'assessments.list_assessments' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}
                       transition-colors">
              </i>
              <span>Assessments</span>
            </a>

            <!-- Send Emails -->
            <a href="{{ url_for('email.email_page') }}" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-xl whitespace-nowrap group
                     {% if request.endpoint == 'email.email_page' %}
                       text-emerald-800 bg-gradient-to-r from-emerald-100 to-white
                       border border-emerald-300 shadow-md -translate-y-0.5
                     {% else %}
                       text-slate-600 hover:text-slate-900
                       hover:bg-gradient-to-r hover:from-white hover:via-emerald-50/60 hover:to-white
                       border border-transparent hover:border-slate-200
                       hover:shadow-sm hover:-translate-y-0.5
                     {% endif %}
                     transition-all">
              <i data-lucide="mail" class="w-5 h-5
                       {% if request.endpoint == 'email.email_page' %}text-emerald-700{% else %}text-slate-500 group-hover:text-emerald-600{% endif %}
                       transition-colors">
              </i>
              <span>Send Emails</span>
            </a>
          </nav>
        </div>

        <div class="mt-auto px-4 py-3 border-t border-slate-100 space-y-3">
          <div class="flex items-center gap-3 text-sm rounded-lg hover:bg-slate-50 p-2">
            {% if session.get('picture') %}
            <img src="{{ session.get('picture') }}" alt="Avatar"
              class="w-9 h-9 rounded-full object-cover border-2 border-white shadow-sm" />
            {% else %}
            <span class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-brand-600 text-white">
              <i data-lucide="user" class="w-5 h-5"></i>
            </span>
            {% endif %}
            <div class="flex-1 min-w-0">
              <div class="text-sm font-medium text-slate-800 truncate">
                {{ session.get('name') or 'Profile' }}
              </div>
              <div class="text-xs text-slate-500 truncate">
                {{ session.get('email') or '' }}
              </div>
            </div>
            <a href="{{ url_for('auth.logout') }}"
              class="p-1.5 rounded-md hover:bg-red-50 text-slate-400 hover:text-red-600 transition-colors"
              onclick="return confirm('Are you sure you want to logout?');" title="Logout">
              <i data-lucide="log-out" class="w-4 h-4"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% block scripts_before %}{% endblock %}

  <script>
    const openBtn = document.getElementById("openSidebar");
    const drawer = document.getElementById("drawer");

    if (openBtn && drawer) {
      openBtn.addEventListener("click", () => {
        drawer.classList.remove("hidden");
      });

      drawer.querySelectorAll("[data-close]").forEach((el) => {
        el.addEventListener("click", () => {
          drawer.classList.add("hidden");
        });
      });
    }

    function toggleDesktopSidebar() {
      const sidebar = document.getElementById("mainSidebar");
      const labels = document.querySelectorAll(".sidebar-text");
      const logoText = document.querySelector(".sidebar-logo-text");
      const logoIcon = document.querySelector(".sidebar-logo-icon");
      const profileText = document.querySelector(".sidebar-profile-text");
      const logoutBtn = document.querySelector(".sidebar-logout-btn");
      const toggleBtn = document.getElementById("sidebar-toggle-btn");
      const profileAvatar = document.querySelector(".sidebar-profile-avatar");
      if (sidebar.classList.contains("w-72")) {
        // COLLAPSE
        sidebar.classList.replace("w-72", "w-20");
        labels.forEach(l => {
          l.style.width = 0;
          l.style.opacity = 0;
          l.style.position = "absolute";
          l.setAttribute("aria-hidden", "true");
        });
        if (logoText && logoIcon) {
          logoText.style.display = "none";
          logoIcon.classList.remove("hidden");
        }
        if (profileText) {
          profileText.style.display = "none";
        }
        if (profileAvatar) {
          profileAvatar.style.display = "none";
        }
        if (logoutBtn) {
          logoutBtn.style.display = null;
        }
        if (toggleBtn) {
          toggleBtn.style.display = "none";
        }
      } else {
        // EXPAND
        sidebar.classList.replace("w-20", "w-72");
        setTimeout(() => {
          labels.forEach(l => {
            l.style.width = null;
            l.style.opacity = 1;
            l.style.position = null;
            l.removeAttribute("aria-hidden");
          });
          if (logoText && logoIcon) {
            logoText.style.display = null;
            logoIcon.classList.add("hidden");
          }
          if (profileText) {
            profileText.style.display = null;
          }
          if (profileAvatar) {
            profileAvatar.style.display = null;
          }
          if (logoutBtn) {
            logoutBtn.style.display = null;
          }
          if (toggleBtn) {
            toggleBtn.style.display = null;
          }
        }, 150);
      }
    }
  </script>

  {% block scripts %}{% endblock %}
</body>

</html>
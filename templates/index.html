{% extends "base.html" %} 
{% block title %}Dashboard â€” AI Lesson Planner{% endblock %} 

{% block content %}
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8">
  <div>
    <h1 class="text-2xl font-bold text-slate-800 tracking-tight">Dashboard</h1>
    <p class="text-sm text-slate-500 mt-1">Welcome back! Here is an overview of your teaching materials.</p>
  </div>
  <div>
    <a
      href="{{ url_for('lesson_plans.lesson_generator_page') }}"
      class="inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-500/20 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
    >
      <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
      New Lesson Plan
    </a>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
  <div class="bg-white p-6 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between relative overflow-hidden group">
    <div class="relative z-10">
      <p class="text-sm font-medium text-slate-500">Total Batches</p>
      <p class="text-3xl font-bold text-slate-800 mt-2">{{ total_batches or 0 }}</p>
    </div>
    <div class="p-3 bg-blue-50 rounded-lg text-blue-600 group-hover:scale-110 transition-transform duration-300">
      <i data-lucide="users" class="w-6 h-6"></i>
    </div>
  </div>

  <div class="bg-white p-6 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between relative overflow-hidden group">
    <div class="relative z-10">
      <p class="text-sm font-medium text-slate-500">Active Plans</p>
      <p class="text-3xl font-bold text-slate-800 mt-2">{{ total_lesson_plans or 0 }}</p>
    </div>
    <div class="p-3 bg-indigo-50 rounded-lg text-indigo-600 group-hover:scale-110 transition-transform duration-300">
      <i data-lucide="book-open" class="w-6 h-6"></i>
    </div>
  </div>

  <div class="bg-white p-6 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between relative overflow-hidden group">
    <div class="relative z-10">
      <p class="text-sm font-medium text-slate-500">Assessments</p>
      <p class="text-3xl font-bold text-slate-800 mt-2">{{ total_assessments or 0 }}</p>
    </div>
    <div class="p-3 bg-emerald-50 rounded-lg text-emerald-600 group-hover:scale-110 transition-transform duration-300">
      <i data-lucide="check-circle" class="w-6 h-6"></i>
    </div>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
  
  <div class="lg:col-span-2 space-y-6">
    <div>
      <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
        <i data-lucide="zap" class="w-4 h-4 text-amber-500"></i> Quick Actions
      </h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        
        <a href="{{ url_for('assessments.assessment_page') }}" 
           class="group p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-blue-300 transition-all duration-200 flex flex-col items-start">
           <div class="p-2 bg-blue-50 text-blue-600 rounded-lg mb-3 group-hover:bg-blue-600 group-hover:text-white transition-colors">
             <i data-lucide="file-question" class="w-5 h-5"></i>
           </div>
           <span class="font-semibold text-slate-800 group-hover:text-blue-700">Generate Assessment</span>
           <span class="text-xs text-slate-500 mt-1">Create quizzes from PDFs</span>
        </a>

        <a href="{{ url_for('assessments.list_assessments') }}" 
           class="group p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-emerald-300 transition-all duration-200 flex flex-col items-start">
           <div class="p-2 bg-emerald-50 text-emerald-600 rounded-lg mb-3 group-hover:bg-emerald-600 group-hover:text-white transition-colors">
             <i data-lucide="send" class="w-5 h-5"></i>
           </div>
           <span class="font-semibold text-slate-800 group-hover:text-emerald-700">View & Send Assessments</span>
           <span class="text-xs text-slate-500 mt-1">Distribute to students</span>
        </a>

        <a href="{{ url_for('batches.batches_page') }}" 
           class="group p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-purple-300 transition-all duration-200 flex flex-col items-start">
           <div class="p-2 bg-purple-50 text-purple-600 rounded-lg mb-3 group-hover:bg-purple-600 group-hover:text-white transition-colors">
             <i data-lucide="users" class="w-5 h-5"></i>
           </div>
           <span class="font-semibold text-slate-800 group-hover:text-purple-700">Manage Batches</span>
           <span class="text-xs text-slate-500 mt-1">Update student lists</span>
        </a>

        <a href="{{ url_for('email.email_page') }}" 
           class="group p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-amber-300 transition-all duration-200 flex flex-col items-start">
           <div class="p-2 bg-amber-50 text-amber-600 rounded-lg mb-3 group-hover:bg-amber-600 group-hover:text-white transition-colors">
             <i data-lucide="mail" class="w-5 h-5"></i>
           </div>
           <span class="font-semibold text-slate-800 group-hover:text-amber-700">Send Emails</span>
           <span class="text-xs text-slate-500 mt-1">Compose updates & reminders</span>
        </a>

      </div>
    </div>
  </div>

  <div class="lg:col-span-1">
    <div class="bg-white rounded-xl shadow-sm border border-slate-100 h-full">
      <div class="p-5 border-b border-slate-100">
        <h3 class="font-semibold text-slate-800">Recent Activity</h3>
      </div>
      
      <div class="p-5">
        {% if dashboard_error %}
        <div class="text-sm text-red-600 bg-red-50 p-3 rounded-md border border-red-100">
          Error: {{ dashboard_error }}
        </div>
        {% endif %}

        <ul class="space-y-6">
          {% if recent_activities %} 
            {% for act in recent_activities %}
            <li class="relative flex gap-4">
              {% if not loop.last %}
              <div class="absolute left-[11px] top-8 bottom-[-24px] w-px bg-slate-200"></div>
              {% endif %}
              
              <div class="relative z-10 flex-none w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 ring-4 ring-white">
                {% if 'assessment' in act.type %}
                  <i data-lucide="file-check" class="w-3 h-3"></i>
                {% elif 'batch' in act.type %}
                  <i data-lucide="user-plus" class="w-3 h-3"></i>
                {% else %}
                  <i data-lucide="file-text" class="w-3 h-3"></i>
                {% endif %}
              </div>
              
               <div class="flex-1 pt-0.5">
                 <p class="text-sm font-medium text-slate-900">
                   {{ act.type | replace('_', ' ') | capitalize }}
                 </p>
                 <p class="text-xs text-slate-500 mt-0.5 line-clamp-1">
                   {{ act.title or "Untitled Item" }}
                 </p>
                 <p class="text-[10px] text-slate-400 mt-1">
                   {% if act.created_at %}{{ act.created_at | timeago }}{% else %}Just now{% endif %}
                 </p>
               </div>
            </li>
            {% endfor %} 
          {% else %}
            <li class="text-sm text-slate-500 text-center py-4 italic">
              No recent activity found.
            </li>
          {% endif %}
        </ul>
      </div>
      
       {% if recent_activities %}
       <div class="p-4 border-t border-slate-100 text-center">
         <a href="{{ url_for('main.activity_page') }}" class="text-xs font-medium text-blue-600 hover:text-blue-700">View all activity &rarr;</a>
       </div>
       {% endif %}
    </div>
  </div>

</div>
{% endblock %}